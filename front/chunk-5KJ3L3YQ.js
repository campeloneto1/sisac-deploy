import{a as z}from"./chunk-GOTAZHJ7.js";import{a as ke}from"./chunk-2HKYVKZJ.js";import{a as R}from"./chunk-HMKSEIRC.js";import{a as B}from"./chunk-QO2ZHOMR.js";import{a as Ve}from"./chunk-Y64AYFHZ.js";import"./chunk-A6GCQO25.js";import{h as $}from"./chunk-NFMIVN66.js";import{a as Ee,b as ye,c as we,d as Te}from"./chunk-AICVXWQ6.js";import{a as L}from"./chunk-I3SZ5FME.js";import{a as Ce}from"./chunk-HYOWEGV7.js";import{a as ge}from"./chunk-3HEW5RTP.js";import{a as be,b as ve}from"./chunk-UKCOEVIY.js";import{a as xe,d as Se}from"./chunk-HDKAZCIU.js";import{$b as U,C as oe,Ca as C,Ea as f,F as se,Fa as c,I as w,Ka as H,La as J,Ma as K,Na as de,Nb as ce,O as h,Oa as o,P as _,Pa as g,Pb as m,Qb as k,Ra as le,Rb as D,Sb as pe,Tb as N,Ua as X,Va as Y,Vb as j,W as F,Wa as Z,Wb as q,Xa as me,Xb as fe,Ya as T,Yb as he,Zb as _e,_b as O,ac as P,ca as l,cb as ee,da as p,eb as te,l as ae,la as S,na as x,sa as b,sb as V,ta as Q,ua as W,va as A,vb as ue,wa as t,xa as i,ya as v}from"./chunk-OWJSVT4P.js";function je(n,s){n&1&&v(0,"input-text",7)(1,"input-text",8)(2,"input-text",9)(3,"input-text",10)}var re=(()=>{let s=class s{constructor(e,r,a,u,y,E,Ie){this.formBuilder=e,this.usersService=r,this.perfisService=a,this.unidadesService=u,this.policiaisService=y,this.subunidadesService=E,this.toastr=Ie,this.refresh=new F}ngOnInit(){this.form=this.formBuilder.group({id:[null],nome:[null,m.compose([m.required,m.minLength(5),m.maxLength(100)])],cpf:[null,m.compose([m.required,m.minLength(11),m.maxLength(11)])],telefone:[null,m.compose([m.minLength(11),m.maxLength(11)])],email:[null,m.compose([m.maxLength(100),m.email])],perfil:[null,m.compose([m.required])],unidade:[null],subunidade:[null],policial:[null]}),this.perfis$=this.perfisService.index(),this.unidades$=this.unidadesService.index(),this.subscription=this.policiaisService.disponiveis().subscribe({next:e=>{e.forEach(r=>{r.numeral?r.nome=`${r.graduacao.abreviatura} ${r.numeral} ${r.nome_guerra}, ${r.matricula}`:r.nome=`${r.graduacao.abreviatura} ${r.nome_guerra}, ${r.matricula}`}),this.policiais$=ae(e)}})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}cadastrar(){delete this.form.value.unidade,this.form.value.id?this.usersService.update(this.form.value.id,this.form.value).subscribe({next:e=>{this.toastr.success("Edi\xE7\xE3o realizada com sucesso!"),this.form.reset(),this.refresh.emit()},error:e=>{this.toastr.error("Erro ao cadastrar, tente novamente mais tarde!")}}):this.usersService.create(this.form.value).subscribe({next:e=>{this.toastr.success("Cadastro realizado com sucesso!"),this.form.reset(),this.refresh.emit()},error:e=>{this.toastr.error("Erro ao cadastrar, tente novamente mais tarde!")}})}editar(e){this.form.patchValue(e),this.form.get("perfil")?.patchValue(e.perfil.id),e.policial&&this.form.get("policial")?.patchValue(e.policial.id),this.form.get("subunidade")?.patchValue(e.subunidade.id),this.form.get("unidade")?.patchValue(e.subunidade.unidade.id),this.getSubunidades()}getSubunidades(){this.subunidades$=this.subunidadesService.whereUnidade(this.form.get("unidade")?.value)}};s.\u0275fac=function(r){return new(r||s)(p(O),p(B),p(ke),p(z),p(Ve),p(R),p($))},s.\u0275cmp=w({type:s,selectors:[["app-users-form"]],outputs:{refresh:"refresh"},standalone:!0,features:[T],decls:11,vars:5,consts:[[3,"formGroup"],[1,"row"],["label","Policial","id","policial","formControlName","policial",1,"col-sm-4",3,"data$"],["label","Perfil","id","perfil","formControlName","perfil",1,"col-sm-4",3,"data$"],[1,"d-flex","justify-content-end"],["data-bs-dismiss","modal",1,"btn","btn-link","text-danger",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click","disabled"],["formControlName","nome","label","Nome","id","nome","tipo","text",1,"col-sm-4"],["mascara","000.000.000-00","formControlName","cpf","label","CPF","id","cpf","tipo","text",1,"col-sm-2"],["mascara","(00) 00000-0000","formControlName","telefone","label","Telefone","id","telefone","tipo","text",1,"col-sm-2"],["formControlName","email","label","E-mail","id","email","tipo","email",1,"col-sm-4"]],template:function(r,a){r&1&&(t(0,"form",0)(1,"div",1),S(2,je,4,0),i(),t(3,"div",1),v(4,"input-select",2)(5,"input-select",3),i(),t(6,"div",4)(7,"a",5),f("click",function(){return a.form.reset()}),o(8,"Cancelar"),i(),t(9,"button",6),f("click",function(){return a.cadastrar()}),o(10," Cadastrar "),i()()()),r&2&&(x("formGroup",a.form),l(2),b(2,a.form.value.policial?-1:2),l(2),x("data$",a.policiais$),l(),x("data$",a.perfis$),l(4),x("disabled",a.form.invalid))},dependencies:[V,U,N,k,D,P,j,q,Ce,L]});let n=s;return n})();var I=be.url,M="users-subunidades",G=(()=>{let s=class s{constructor(e){this.http=e}index(){return this.http.get(`${I}/${M}`)}find(e){return this.http.get(`${I}/${M}/${e}`)}create(e){return this.http.post(`${I}/${M}`,e)}update(e,r){return this.http.put(`${I}/${M}/${e}`,r)}remove(e){return this.http.delete(`${I}/${M}/${e}`)}};s.\u0275fac=function(r){return new(r||s)(se(ue))},s.\u0275prov=oe({token:s,factory:s.\u0275fac,providedIn:"root"});let n=s;return n})();var ne=(()=>{let s=class s{constructor(e,r,a,u,y){this.formBuilder=e,this.usersSubunidadesService=r,this.unidadesService=a,this.subunidadesService=u,this.toastr=y,this.refresh=new F,this.cancel=new F}ngOnInit(){this.form=this.formBuilder.group({id:[null],user:[null],unidade:[null,m.compose([m.required])],subunidade:[null,m.compose([m.required])]}),this.unidades$=this.unidadesService.index()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}cadastrar(){delete this.form.value.unidade,this.form.get("user")?.patchValue(this.user),this.form.value.id?this.usersSubunidadesService.update(this.form.value.id,this.form.value).subscribe({next:e=>{this.toastr.success("Edi\xE7\xE3o realizada com sucesso!"),this.form.reset(),this.refresh.emit()},error:e=>{this.toastr.error("Erro ao cadastrar, tente novamente mais tarde!")}}):this.usersSubunidadesService.create(this.form.value).subscribe({next:e=>{this.toastr.success("Cadastro realizado com sucesso!"),this.form.reset(),this.refresh.emit()},error:e=>{this.toastr.error("Erro ao cadastrar, tente novamente mais tarde!")}})}editar(e){this.form.patchValue(e)}cancelar(){this.form.reset(),this.cancel.emit()}getSubunidades(){this.subunidades$=this.subunidadesService.whereUnidade(this.form.value.unidade)}};s.\u0275fac=function(r){return new(r||s)(p(O),p(G),p(z),p(R),p($))},s.\u0275cmp=w({type:s,selectors:[["app-users-subunidades-form"]],inputs:{user:"user"},outputs:{refresh:"refresh",cancel:"cancel"},standalone:!0,features:[T],decls:9,vars:4,consts:[[3,"formGroup"],[1,"row"],["label","Unidade","id","unidade","formControlName","unidade",1,"col-sm-4",3,"ngModelChange","data$"],["label","Subunidade","id","subunidade","formControlName","subunidade",1,"col-sm-6",3,"data$"],[1,"d-flex","justify-content-end"],[1,"btn","btn-link","text-danger",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(r,a){r&1&&(t(0,"form",0)(1,"div",1)(2,"input-select",2),f("ngModelChange",function(){return a.getSubunidades()}),i(),v(3,"input-select",3),i(),t(4,"div",4)(5,"a",5),f("click",function(){return a.cancelar()}),o(6,"Cancelar"),i(),t(7,"button",6),f("click",function(){return a.cadastrar()}),o(8," Cadastrar "),i()()()),r&2&&(x("formGroup",a.form),l(2),x("data$",a.unidades$),l(),x("data$",a.subunidades$),l(4),x("disabled",a.form.invalid))},dependencies:[V,U,N,k,D,P,j,q,L]});let n=s;return n})();function qe(n,s){n&1&&(t(0,"button",7),v(1,"i",41),i())}function Oe(n,s){if(n&1&&(o(0),ee(1,"mask")),n&2){let d=c().$implicit;g(te(1,1,d.telefone,"(00) 00000-0000"))}}function Pe(n,s){n&1&&v(0,"i",45)}function Le(n,s){if(n&1&&o(0),n&2){let d=c().$implicit;g(d.perfil.nome)}}function Be(n,s){if(n&1){let d=C();t(0,"a",50),f("click",function(){h(d);let r=c().$implicit,a=c(2);return _(a.reset(r))}),v(1,"i",51),i()}}function Re(n,s){if(n&1){let d=C();t(0,"a",52),f("click",function(){h(d);let r=c().$implicit,a=c(2);return _(a.editar(r))}),v(1,"i",53),i()}}function ze(n,s){if(n&1){let d=C();t(0,"a",54),f("click",function(){h(d);let r=c().$implicit,a=c(2);return _(a.delete(r))}),v(1,"i",55),i()}}function Ge(n,s){if(n&1){let d=C();t(0,"tr",44)(1,"td"),o(2),i(),t(3,"td"),o(4),i(),t(5,"td"),o(6),ee(7,"mask"),i(),t(8,"td"),S(9,Oe,2,4),i(),t(10,"td"),S(11,Pe,1,0,"i",45),i(),t(12,"td"),S(13,Le,1,1),i(),t(14,"td")(15,"button",46),f("click",function(){let r=h(d).$implicit,a=c(2);return _(a.showSubunidades(r))}),o(16," Subunidades "),i()(),t(17,"td"),S(18,Be,2,0,"a",47)(19,Re,2,0,"a",48)(20,ze,2,0,"a",49),i()()}if(n&2){let d=s.$implicit,e=c(2);l(2),g(d.id),l(2),g(d.nome),l(2),g(te(7,9,d.cpf,"000.000.000-00")),l(3),b(9,d.telefone?9:-1),l(2),b(11,d.policial?11:-1),l(2),b(13,d.perfil?13:-1),l(5),b(18,e.user.perfil.usuarios_edt?18:-1),l(),b(19,e.user.perfil.usuarios_edt?19:-1),l(),b(20,e.user.perfil.usuarios_del?20:-1)}}function Qe(n,s){n&1&&(t(0,"tr")(1,"td",25),o(2,"Sem informa\xE7\xE3o"),i()())}function We(n,s){if(n&1&&(t(0,"tbody"),W(1,Ge,21,12,"tr",44,Q,!1,Qe,3,0,"tr"),i()),n&2){c();let d=de(21);l(),A(d.data)}}function Ae(n,s){if(n&1){let d=C();o(0," Tem certeza que deseja resetar a senha de "),t(1,"b"),o(2),i(),o(3,"? "),t(4,"div",56)(5,"a",57),o(6,"Cancelar"),i(),t(7,"button",58),f("click",function(){h(d);let r=c();return _(r.confirmReset())}),o(8," Confirmar "),i()()}if(n&2){let d=c();l(2),g(d.usuario.nome)}}function He(n,s){if(n&1){let d=C();o(0," Tem certeza que deseja excluir: "),t(1,"b"),o(2),i(),t(3,"div",56)(4,"a",59),o(5,"Cancelar"),i(),t(6,"button",60),f("click",function(){h(d);let r=c();return _(r.confirm())}),o(7," Excluir "),i()()}if(n&2){let d=c();l(2),g(d.excluir.nome)}}function Je(n,s){if(n&1){let d=C();t(0,"app-users-subunidades-form",61),f("refresh",function(){h(d);let r=c();return _(r.refreshSubunidades())})("cancel",function(){h(d);let r=c();return _(r.cancelarCadSubunidade())}),i()}if(n&2){let d=c();x("user",d.usuario.id||0)}}function Ke(n,s){if(n&1){let d=C();t(0,"tr")(1,"td"),o(2),i(),t(3,"td"),o(4),i(),t(5,"td"),o(6),i(),t(7,"td")(8,"i",62),f("click",function(){let r=h(d).$implicit,a=c(2);return _(a.rmvSubunidade(r.id||0))}),i()()()}if(n&2){let d=s.$implicit;l(2),g(d.id),l(2),g(d.subunidade.unidade.nome),l(2),le("",d.subunidade.nome," (",d.subunidade.abreviatura,")")}}function Xe(n,s){if(n&1&&(t(0,"table",43)(1,"thead")(2,"tr")(3,"th"),o(4,"#"),i(),t(5,"th"),o(6,"Unidade"),i(),t(7,"th"),o(8,"Subunidade"),i(),t(9,"th"),o(10,"Op\xE7\xF5es"),i()()(),t(11,"tbody"),W(12,Ke,9,4,"tr",null,Q),i()()),n&2){let d=c();l(12),A(d.usuario.users_subunidades)}}var Mt=(()=>{let s=class s{constructor(e,r,a,u){this.usersService=e,this.usersSubunidadesService=r,this.toastr=a,this.sessionService=u,this.quant=10,this.cadsubunidade=!1}ngOnInit(){this.user=this.sessionService.getUser(),this.sessionService.checkPermission("usuarios"),this.subscription=this.usersService.index().subscribe({next:e=>{this.data$=e,this.temp=e}})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}refresh(){this.usersService.index().subscribe({next:e=>{this.data$=e}})}editar(e){this.child.editar(e)}delete(e){this.excluir=e}confirm(){this.usersService.remove(this.excluir.id||0).subscribe({next:e=>{this.toastr.success("Exclus\xE3o realizada com sucesso!"),this.refresh()},error:e=>{this.toastr.error("Erro ao excluir, tente novamente mais tarde!")}})}reset(e){this.usuario=e}confirmReset(){this.usersService.reset(this.usuario).subscribe({next:e=>{this.toastr.success("Senha alterada com sucesso!"),this.refresh()},error:e=>{this.toastr.error("Erro ao alterar senha, tente novamente mais tarde!")}})}showSubunidades(e){this.usuario=e}refreshSubunidades(){this.cadsubunidade=!1,this.usersService.find(this.usuario.id||0).subscribe({next:e=>{this.usuario=e,this.refresh()},error:e=>{this.toastr.error("Erro ao consultar contrato!")}})}cancelarCadSubunidade(){this.cadsubunidade=!1}rmvSubunidade(e){window.confirm("Tem certeza que deseja excluir a subunidade?")&&this.usersSubunidadesService.remove(e).subscribe({next:r=>{this.usersService.find(this.usuario.id||0).subscribe({next:a=>{this.usuario=a,this.refresh()}})}})}pesquisar(){if(this.data$=this.temp,this.pesquisa.length>0){var e=this.pesquisa.toLocaleLowerCase();this.data$=this.data$.filter(r=>r.nome.toLocaleLowerCase().indexOf(e)!==-1||r.cpf.toLocaleLowerCase().indexOf(e)!==-1||r.perfil.nome.toLocaleLowerCase().indexOf(e)!==-1||!e)}}};s.\u0275fac=function(r){return new(r||s)(p(B),p(G),p($),p(ve))},s.\u0275cmp=w({type:s,selectors:[["app-users"]],viewQuery:function(r,a){if(r&1&&(H(re,5),H(ne,5)),r&2){let u;J(u=K())&&(a.child=u.first),J(u=K())&&(a.child2=u.first)}},standalone:!0,features:[me([xe()]),T],decls:100,vars:12,consts:[["mf","mfDataTable"],[1,"content-wrapper"],["titulo","Usu\xE1rios"],[1,"content"],[1,"card"],[1,"card-header","border-0"],[1,"card-title"],["data-bs-toggle","modal","data-bs-target","#modalcad","title","Cadastrar",1,"btn","btn-outline-primary"],[1,"card-tools"],[1,"input-group","input-group-sm",2,"width","250px"],[1,"form-control","float-right",2,"width","50px",3,"ngModelChange","ngModel"],["value","10"],["value","25"],["value","50"],["value","100"],["type","text","name","table_search","placeholder","Pesquisar...",1,"form-control","float-right",2,"width","200px",3,"ngModelChange","ngModel"],[1,"card-body","table-responsive","p-1"],[1,"table","table-hover","table-head-fixed","text-nowrap",3,"mfData","mfRowsOnPage","mfSortBy","mfSortOrder"],["by","id"],["by","nome"],["by","cpf"],["by","telefone"],["by","policial.id"],["by","perfil.nome"],["by","users_subunidades"],["colspan","100%"],[2,"display","flex","align-items","center","justify-content","center"],["id","modalcad","aria-hidden","true",1,"modal","fade",2,"display","none"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header","border-0"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[3,"refresh"],["id","modalreset","aria-hidden","true",1,"modal","fade",2,"display","none"],[1,"modal-dialog"],["id","modaldel","aria-hidden","true",1,"modal","fade",2,"display","none"],["id","modalsubs","aria-hidden","true",1,"modal","fade",2,"display","none"],["title","Cadastrar",1,"btn","btn-outline-primary",3,"click"],[1,"fa","fa-plus"],[3,"user"],[1,"table","table-hover","table-head-fixed","text-nowrap","mt-1"],[1,"optionshover"],["aria-hidden","true",1,"fa","fa-check"],["data-bs-toggle","modal","data-bs-target","#modalsubs",1,"btn","btn-xs","btn-outline-primary",3,"click"],["title","Resetar Senha","data-bs-toggle","modal","data-bs-target","#modalreset",1,"options","point"],["title","Editar","data-bs-toggle","modal","data-bs-target","#modalcad",1,"options","point","ml-1"],["title","Excluir","data-bs-toggle","modal","data-bs-target","#modaldel",1,"options","point","ml-1"],["title","Resetar Senha","data-bs-toggle","modal","data-bs-target","#modalreset",1,"options","point",3,"click"],["aria-hidden","true",1,"fa","fa-refresh","text-primary"],["title","Editar","data-bs-toggle","modal","data-bs-target","#modalcad",1,"options","point","ml-1",3,"click"],["aria-hidden","true",1,"fa","fa-edit","text-primary"],["title","Excluir","data-bs-toggle","modal","data-bs-target","#modaldel",1,"options","point","ml-1",3,"click"],["aria-hidden","true",1,"fa","fa-trash","text-danger"],[1,"d-flex","justify-content-end"],["data-bs-dismiss","modal",1,"btn","btn-link","text-danger"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-link","text-primary"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],[3,"refresh","cancel","user"],["aria-hidden","true",1,"fa","fa-trash","text-danger","point",3,"click"]],template:function(r,a){if(r&1){let u=C();t(0,"div",1),v(1,"app-title",2),t(2,"section",3)(3,"div",4)(4,"div",5)(5,"h3",6),S(6,qe,2,0,"button",7),i(),t(7,"div",8)(8,"div",9)(9,"select",10),Z("ngModelChange",function(E){return h(u),Y(a.quant,E)||(a.quant=E),_(E)}),t(10,"option",11),o(11,"10"),i(),t(12,"option",12),o(13,"25"),i(),t(14,"option",13),o(15,"50"),i(),t(16,"option",14),o(17,"100"),i()(),t(18,"input",15),Z("ngModelChange",function(E){return h(u),Y(a.pesquisa,E)||(a.pesquisa=E),_(E)}),f("ngModelChange",function(){return h(u),_(a.pesquisar())}),i()()()(),t(19,"div",16)(20,"table",17,0)(22,"thead")(23,"tr")(24,"th")(25,"mfDefaultSorter",18),o(26,"#"),i()(),t(27,"th")(28,"mfDefaultSorter",19),o(29,"Nome"),i()(),t(30,"th")(31,"mfDefaultSorter",20),o(32,"CPF"),i()(),t(33,"th")(34,"mfDefaultSorter",21),o(35,"Telefone"),i()(),t(36,"th")(37,"mfDefaultSorter",22),o(38,"Policial"),i()(),t(39,"th")(40,"mfDefaultSorter",23),o(41,"Perfil"),i()(),t(42,"th")(43,"mfDefaultSorter",24),o(44,"Subunidades"),i()(),t(45,"th"),o(46,"Op\xE7\xF5es"),i()()(),S(47,We,4,1,"tbody"),t(48,"tfoot")(49,"tr")(50,"td",25)(51,"div",26),v(52,"mfBootstrapPaginator"),i()()()()()()()(),t(53,"div",27)(54,"div",28)(55,"div",29)(56,"div",30)(57,"h4",31),o(58,"Cadastrar"),i(),t(59,"button",32)(60,"span",33),o(61,"\xD7"),i()()(),t(62,"div",34)(63,"app-users-form",35),f("refresh",function(){return h(u),_(a.refresh())}),i()()()()(),t(64,"div",36)(65,"div",37)(66,"div",29)(67,"div",30)(68,"h4",31),o(69,"Excluir"),i(),t(70,"button",32)(71,"span",33),o(72,"\xD7"),i()()(),t(73,"div",34),S(74,Ae,9,1),i()()()(),t(75,"div",38)(76,"div",37)(77,"div",29)(78,"div",30)(79,"h4",31),o(80,"Excluir"),i(),t(81,"button",32)(82,"span",33),o(83,"\xD7"),i()()(),t(84,"div",34),S(85,He,8,1),i()()()(),t(86,"div",39)(87,"div",28)(88,"div",29)(89,"div",30)(90,"h4",31),o(91," Subunidades "),t(92,"button",40),f("click",function(){return h(u),_(a.cadsubunidade=!0)}),v(93,"i",41),i()(),t(94,"button",32)(95,"span",33),o(96,"\xD7"),i()()(),t(97,"div",34),S(98,Je,1,1,"app-users-subunidades-form",42)(99,Xe,14,0,"table",43),i()()()()()}r&2&&(l(6),b(6,a.user.perfil.usuarios_cad?6:-1),l(3),X("ngModel",a.quant),l(9),X("ngModel",a.pesquisa),l(2),x("mfData",a.data$)("mfRowsOnPage",a.quant)("mfSortBy","nome")("mfSortOrder","asc"),l(27),b(47,a.data$?47:-1),l(27),b(74,a.usuario?74:-1),l(11),b(85,a.excluir?85:-1),l(13),b(98,a.cadsubunidade?98:-1),l(),b(99,a.usuario?99:-1))},dependencies:[V,ge,re,ne,Te,Ee,we,ye,U,he,_e,ce,fe,k,pe,Se]});let n=s;return n})();export{Mt as UsersComponent};
